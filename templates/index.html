<!doctype html>
<html>
<head>
<title>League of Interns</title>
<link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />
<link type="text/css" rel="stylesheet" href="/stylesheets/jquery.countdown.css" />
</head>
<body>

<div id="wrapper">

<div id="header">
    <h1>League of Interns</h1>
    <h2>An internal <a href="http://en.wikipedia.org/wiki/Assassin_(game)">assassins</a>
        game for the summer MTV interns of 2012</h2>
</div>

{# TODO(billycao): Add wrapper/styles for this #}
{% if FLAGS_show_game_title  %}
    <h1>Game: {{ game_name }}</h1>
{% endif %}

{% if not game_started %}
    <div id="countdown_wrapper">
        <div id="countdown"></div>
        <p id="note" class="note"></p>
    </div>

    {% if not is_registered %}
    <div id="register_wrapper">
        {% if num_players >= FLAGS_max_players %}
            Sorry, but the maximum player count of {{ FLAGS_max_players }} has been reached.<br /><br />
            Please check back soon, as there is a good chance we will raise this cap.
        {% else %}
        <form action="/join" method="post">
            <fieldset>
                Are you an intern? What are you waiting for? <br />
                Join the other <b>{{ num_players }}</b> assassin{{ num_players|pluralize }}!<br />
                {# TODO(billycao): Make this system work for multiple games. #}
                <input name="game_name" value="{{ game_name }}" hidden/>
                <!--
                <select name="game_name" hidden>
                    {% for game in games %}
                        <option>{{ game.key.name }}</option>
                    {% endfor %}
                </select>
                -->
                <input class="big_button" type="submit" value="Join the fray!"><br />
                <small>Your username <b>{{ player_name }}</b> will be recorded.</small>
            </fieldset>
        </form>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    {% if not is_registered %}
    Sorry! Registration has ended and the game is underway!<br /><br />
    Check back soon for game results!
    {% endif %}
{% endif %}

{% if is_registered %}
    <div id="status">
    {% if game_started %}
        {% if winner %}
            {{ winner.assassin }} won.
        {% else %}
            {% if target_mission %}
                <strong>The games have begun!</strong>
                <hr />
                Your target is <strong>{{ target_mission.victim|default:"unassigned" }}</strong>.
                <form id="killform" action="/kill" method="post">
                    <input type="text" id="killcode" name="killcode" />
                    <label for="killcode">Press 'Enter' to submit your kill code.</label>
                </form>
                <hr />
                Your kill code is:<br />
                <div class="hidden_hover">
                    {{ player_code }}
                </div>
                <small>Hover to view. Click here to change it.</small>
            {% else %}
                You are dead. :(<br />
                <small>Think you died in error? Contact us below!</small>
            {% endif %}
        {% endif %}
    {% else %}
        Welcome to the League!
        <hr />
        Your kill code is
        <div class="hidden_hover">
            {{ player_code }}
        </div>
        <small>Hover to view. Keep it hidden. Keep it safe.</small>
        <hr />
        Please review the rules below, pick up your weapon from <b>MTV-42-132</b>, and wait for your first target!
        <hr />
        <small>{{ num_players|add:-1 }} other interns have joined.</small>
    {% endif %}
    </div>
{% endif %}


<div id="columns_wrapper">
    <div id="column_left">

    </div>
    <div id="column_right">

    </div>
</div>

<div id="footer">
    <a href="{{ url }}">{{ url_linktext }}</a> |
    <a href="mailto:billycao+league@google.com,nsolichin+league@google.com,shiryehoshua+league@google.com?subject=[League of Interns]" target="_blank">
        Contact Us
    </a>
</div>

</div> <!-- wrapper -->
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/javascript" src="/js/jquery.countdown.js"></script>
<script type="text/javascript" src="/js/main.js"></script>
<script type="text/javascript">
jQuery(function() {
    {% if is_registered %}
        // Show countdown to game start
        var ts = new Date(2012, 7, 2, 11, 0).getTime();
        var event = "the games begin!";
    {% else %}
        // Show countdown to registration end
        var ts = new Date(2012, 7, 2, 0, 0).getTime();
        var event = "registration ends!";
    {% endif %}

    $('#countdown').countdown({
        timestamp	: ts,
        callback	: function(days, hours, minutes, seconds){
            var message = "";
            message += days + " day" + ( days==1 ? '':'s' ) + ", ";
            message += hours + " hour" + ( hours==1 ? '':'s' ) + ", ";
            message += minutes + " minute" + ( minutes==1 ? '':'s' ) + " and ";
            message += seconds + " second" + ( seconds==1 ? '':'s' ) + " <br />";
            message += "left until " + event;
            $('#note').html(message);
        }
    });
    
    var killform = $('#killform');
    if (killform.length) {
      killform.submit(function() {
        $.post(killform.attr('action'), killform.serialize(), function(data) {
          alert(data);
        });
        killform.children('#killcode').val('');
        return false;
      });
    }
    $('#killcode').focus();
});
</script>
</body>
</html>
